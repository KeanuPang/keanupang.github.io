<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>swift | Living today for tomorrow</title><meta name=keywords content><meta name=description content="Living today for tomorrow"><meta name=author content="Keanu Pang"><link rel=canonical href=https://keanupang.github.io/tags/swift/><link crossorigin=anonymous href=/assets/css/stylesheet.d7fb4cbf980fe688a21621b06a795933c4e6bb2d4070ec940667af1715d84af2.css integrity="sha256-1/tMv5gP5oiiFiGwanlZM8Tmuy1AcOyUBmevFxXYSvI=" rel="preload stylesheet" as=style><link rel=icon href=https://keanupang.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://keanupang.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://keanupang.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://keanupang.github.io/apple-touch-icon.png><link rel=mask-icon href=https://keanupang.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://keanupang.github.io/tags/swift/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="swift"><meta property="og:description" content="Living today for tomorrow"><meta property="og:type" content="website"><meta property="og:url" content="https://keanupang.github.io/tags/swift/"><meta name=twitter:card content="summary"><meta name=twitter:title content="swift"><meta name=twitter:description content="Living today for tomorrow"></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=https://keanupang.github.io accesskey=h title="Living today for tomorrow (Alt + H)">Living today for tomorrow</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://keanupang.github.io/about title=About><span>About</span></a></li><li><a href=https://keanupang.github.io/posts title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>swift</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>試玩 Hummingbird 的 middleware</h2></header><div class=entry-content><p>之前為了測試 Hummingbird 這個輕量 server framework 所以做了一個叫 LocalWeb 的 web project，主要是用來讓使用者在開發環境下方便地瀏覽與下載檔案；結果沒想到內建的 middleware 就幾乎把所有事情都搞定了。
當然還是要再加點工才可以方便使用，例如當我點進目錄時，希望可以一覽目錄下的檔案清單，所以就客製化做了個 middleware 掛上來，把目錄下的檔案展開成清單做成連結讓使用者可以下載，當使用者點到檔案時就直接串到 HBFileMiddleware 下載檔案這樣。
第一次嘗試實作 Hummingbird 的 middleware 所以花了點時間研究，目前實作版本可以參考這 DirectoryIndexMiddleware ，還好進入門檻不高就是，花最多時間反而是在刻呈現頁面的 html。
因為想呈現那種傳統 Apache web server 檢視目錄下的復古感，於是參考 HBResponseGenerator 這個 protocol，是用來產生 response 結果頁，基本上只要實作 func response(from request: HBRequest) 把刻好的 html 產生成 HBResponse 結果就可以。
成品像是這樣 DirectoryIndexPage 會在剛剛的 DirectoryIndexMiddleware 裡被用到回傳 response。
為了求快所以先不套用什麼 template engine，直接用 String 拼出來，之後有時間再研究看看 Stencil 還是 Leaf 哪個好用。
雛型差不多完成之後，想說要掛個 HTTPS 功能結果好像沒有那麼直覺。本來以為只要把 Configuration 裡的 tlsOptions 設定上去就好，然後就會被噴 warning 訊息：
tlsOptions set in Configuration will not be applied to a BSD sockets server....</p></div><footer class=entry-footer><span title='2022-06-28 02:05:11 +0800 +0800'>June 28, 2022</span>&nbsp;·&nbsp;Keanu Pang</footer><a class=entry-link aria-label="post link to 試玩 Hummingbird 的 middleware" href=https://keanupang.github.io/posts/side-project-hummingbird-localweb/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>快速實驗與驗證功能的小工具 swift-sh</h2></header><div class=entry-content><p>OK, 我們現在可以用 swift-sh 工具預先安裝到系統裡，這樣子之後只要做小型測試時只要單一個 swift 檔案，裡面標註 import 的敘述，就可以直接執行它。
先安裝好 swift-sh 工具：
brew install swift-sh 然後就可以開始編寫 swift 檔案做小型的驗證：
#!/usr/bin/swift sh import Foundation import PromiseKit // @mxcl ~> 6.5 firstly { after(.seconds(2)) }.then { after(.milliseconds(500)) }.done { print("notice: two and a half seconds elapsed") exit(0) } RunLoop.main.run() 要記得檔案最前面的 shebang 要寫明 #!/usr/bin/swift sh 的敘述，這樣系統才會去觸發 swift-sh 工具來處理；以及 import 第三方套件時，要在該行的最後加上註解是哪個 SwiftPM 的來源，甚至可以標註版本。
最後只要把這個檔案加上可執行權限就可以直接執行了。</p></div><footer class=entry-footer><span title='2021-12-03 00:00:00 +0000 UTC'>December 3, 2021</span>&nbsp;·&nbsp;Keanu Pang</footer><a class=entry-link aria-label="post link to 快速實驗與驗證功能的小工具 swift-sh" href=https://keanupang.github.io/posts/tool_swift_sh_for_prototyping/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Failable Initializer 筆記</h2></header><div class=entry-content><p>之前在 這篇文章 看到的。
將自己的 class 來做出一個可以是 optional 的物件，這樣一來使用的時候就必須用 if-let 或 guard 來讀取，在程式上會比較好理解跟處理。
直接上 code：
class FilteredImage { ... init?(with imageName: String) { guard let image = UIImage(named: imageName) else { return nil } self.image = image } } 也就是說在初始化時是用 init? 的方式，確保回傳得到的物件要嘛是 nil 要嘛真的有值，而且對應的屬性也保證有值。
使用上也因為初始化回傳的是 optional 物件，限制了使用者必須用 if-let 或 guard 來拿取：
guard let filteredImage = FilteredImage(with: "bird") else { // filteredImage is nil return } // filteredImage is initialized and we use it normally 然後要保持一個原則，回傳是 nil 一定是因為初始化失敗而得到的，如果是後面的行為造成的話等於權責不分無法抓住問題：...</p></div><footer class=entry-footer><span title='2021-06-01 00:00:00 +0000 UTC'>June 1, 2021</span>&nbsp;·&nbsp;Keanu Pang</footer><a class=entry-link aria-label="post link to Failable Initializer 筆記" href=https://keanupang.github.io/posts/failable_initializer/></a></article></main><footer class=footer><span>&copy; 2023 <a href=https://keanupang.github.io>Living today for tomorrow</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>